<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Configuration Serveur</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Configuration Serveur</h1><br/><p>Tout d&#39;abord , j&#39;ai commence par changer les droits utilisateurs sur les fichiers de configuration comme suit.</p><p></p><p><h3>Generer la cle TSIG</h3></p><p><div class="codebox"><pre><span style="color:#bf2e5e;font-weight:400">sudo</span> tsig-keygen -a HMAC-SHA256 ddns-key &gt; <span style="color:#bf2e5e;font-weight:400">/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>bind<span style="color:#bf2e5e;font-weight:400">/</span>ddns<span style="color:#bf2e5e;font-weight:400">/</span>ddclient.key</pre></div></p><p>le resultat du cotenu du fichier devrait ressembler a :</p><p><div class="codebox"><pre>key <span style="color:#5ebdab;font-weight:400">&quot;ddns-key&quot;</span> <span style="color:#bf2e5e;font-weight:400">{</span><br />        algorithm hmac-sha256<span style="color:#bf2e5e;font-weight:400">;</span><br />        secret <span style="color:#5ebdab;font-weight:400">&quot;uW1B399nahrFJT/rmHGaSaz6MbAJS7Q05J7hEQ/7V/M=&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span><br /><span style="color:#bf2e5e;font-weight:400">};</span><br /></pre></div></p><p>C&#39;est cette meme cle qui sera partager entre le serveur et le client.</p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p></p><p><strong>NB</strong>: Nos configuration se feront dans le repertoire<em> /etc/bind </em>de notre serveur DNS.</p><p></p><p><div class="codebox"><pre>kercy@ansible<span style="color:#bf2e5e;font-weight:400">:/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>bind$ <span style="color:#bf2e5e;font-weight:400">ls</span> -alh db.*<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 255 Aug 21 15<span style="color:#bf2e5e;font-weight:400">:</span>46 db.0<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 271 Oct 19 04<span style="color:#bf2e5e;font-weight:400">:</span>21 db.127.bck<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 298 Oct 19 14<span style="color:#bf2e5e;font-weight:400">:</span>21 db.172-16-0<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 237 Aug 18 18<span style="color:#bf2e5e;font-weight:400">:</span>02 db.255<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 328 Oct 24 14<span style="color:#bf2e5e;font-weight:400">:</span>10 db.ansible.local<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 353 Aug 18 18<span style="color:#bf2e5e;font-weight:400">:</span>02 db.empty<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 270 Oct 19 04<span style="color:#bf2e5e;font-weight:400">:</span>21 db.local.bck<br /><br /><span style="color:#bf2e5e;font-weight:400">//</span> pour changer et obtenir le resultat ci-dessus ,utilise la commande<br /><br /><span style="color:#bf2e5e;font-weight:400">sudo</span> <span style="color:#bf2e5e;font-weight:400">chown</span> bind<span style="color:#bf2e5e;font-weight:400">:</span>bind db.*<br /><span style="color:#bf2e5e;font-weight:400">sudo</span> <span style="color:#bf2e5e;font-weight:400">chmod</span> 664 db.*<br /><br />kercy@ansible<span style="color:#bf2e5e;font-weight:400">:/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>bind$ <span style="color:#bf2e5e;font-weight:400">ls</span> -alh named.conf*<br />-rw<span style="color:#4a88f1;font-weight:400">-r</span>--r-- 1 root <span style="color:#bf2e5e;font-weight:400">bind</span>  461 Oct 23 14<span style="color:#bf2e5e;font-weight:400">:</span>59 named.conf<br />-rw<span style="color:#4a88f1;font-weight:400">-r</span>--r-- 1 root <span style="color:#bf2e5e;font-weight:400">bind</span>  498 Aug 18 18<span style="color:#bf2e5e;font-weight:400">:</span>02 named.conf.default-zones<br />-rw<span style="color:#4a88f1;font-weight:400">-r</span>--r-- 1 root <span style="color:#bf2e5e;font-weight:400">bind</span>  630 Oct 24 14<span style="color:#bf2e5e;font-weight:400">:</span>08 named.conf.local<br />-rw<span style="color:#4a88f1;font-weight:400">-r</span>--r-- 1 root <span style="color:#bf2e5e;font-weight:400">bind</span>  165 Oct 19 04<span style="color:#bf2e5e;font-weight:400">:</span>17 named.conf.local.bck<br />-rw<span style="color:#4a88f1;font-weight:400">-r</span>--r-- 1 root <span style="color:#bf2e5e;font-weight:400">bind</span> 1.1K Oct 24 03<span style="color:#bf2e5e;font-weight:400">:</span>51 named.conf.options<br /> </pre></div></p><p></p><p>Ici ,pour eviter de refaire a zero le travail ,j&#39;ai simplement copier le fichier par defaut de configuration de la zone directe et de la zone indirecte ,je leur ai attribuer un nom plus intuitif .Petit rappel ne jamais oublier de creer des fichiers de backup au cas ou ca crame.</p><p><ul><li>Configuration de la<strong> zone Directe</strong></li></ul></p><p></p><p><div class="codebox"><pre>  GNU nano 7.2                                                                                                 db.ansible.local                                                                                                          <br /><span style="color:#bf2e5e;font-weight:400">;</span><br /><span style="color:#bf2e5e;font-weight:400">;</span> BIND data <span style="color:#bf2e5e;font-weight:400">file</span> <span style="color:#bf2e5e;font-weight:400">for</span> <span style="color:#9755b3;font-weight:400">local</span> loopback interface<br />;<br />$TTL    604800<br />@       IN      SOA     ns1.ansible.local. kercy.ansible.local. (<br />                              2         ; Serial<br />                         604800         ; Refresh<br />                          86400         ; Retry<br />                        2419200         ; Expire<br />                         604800 )       ; Negative Cache TTL<br />;<br />@       IN      NS      ns1.ansible.local.<br />ns1     IN      A       172.16.0.100<br />@       IN      A       172.16.0.100<br />myhost  IN      A       192.168.10.30<br /><br /><br /><br /><br /><br /><br />^G Help          ^O Write Out     ^W Where Is      ^K Cut           ^T Execute       ^C Location      M-U Undo         M-A Set Mark     M-] To Bracket   M-Q Previous     ^B Back          ^◂ Prev Word     ^A Home<br />^X Exit          ^R Read File     ^\ Replace       ^U Paste         ^J Justify       ^/ Go To Line    M-E Redo         M-6 Copy         ^Q Where Was     M-W Next         ^F Forward       ^▸ Next Word     ^E End<br /></pre></div></p><p><ul><li>Configuration de la <strong>zone Indirecte</strong></li></ul></p><p></p><p></p><p><div class="codebox"><pre>  GNU nano 7.2                                                                                                   db.172-16-0                                                                                                             <br /><span style="color:#bf2e5e;font-weight:400">;</span><br /><span style="color:#bf2e5e;font-weight:400">;</span> BIND reverse data <span style="color:#bf2e5e;font-weight:400">file</span> <span style="color:#bf2e5e;font-weight:400">for</span> <span style="color:#9755b3;font-weight:400">local</span> loopback interface<br />;<br />$TTL    604800<br />@       IN      SOA     ns1.ansible.local. kercy.ansible.local. (<br />                              1         ; Serial<br />                         604800         ; Refresh<br />                          86400         ; Retry<br />                        2419200         ; Expire<br />                         604800 )       ; Negative Cache TTL<br />;<br />@       IN      NS      ns1.ansible.local.<br />100     IN      PTR     ns1.ansible.local.<br /><br />                                                                                                            [ Read 13 lines ]<br />^G Help          ^O Write Out     ^W Where Is      ^K Cut           ^T Execute       ^C Location      M-U Undo         M-A Set Mark     M-] To Bracket   M-Q Previous     ^B Back          ^◂ Prev Word     ^A Home<br />^X Exit          ^R Read File     ^\ Replace       ^U Paste         ^J Justify       ^/ Go To Line    M-E Redo         M-6 Copy         ^Q Where Was     M-W Next         ^F Forward       ^▸ Next Word     ^E End<br /></pre></div></p><p><ul><li>Configuration des fichiers<strong> named.conf*</strong></li></ul></p><p>				</p><p></p><p><div class="codebox"><pre>  GNU nano 7.2                                                                                               named.conf.options                                                                                                         <br />options <span style="color:#bf2e5e;font-weight:400">{</span><br />        directory <span style="color:#5ebdab;font-weight:400">&quot;/var/cache/bind&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span><br /><br />        <span style="color:#bf2e5e;font-weight:400">//</span> If there is a firewall between you and nameservers you want<br />        <span style="color:#bf2e5e;font-weight:400">//</span> to talk to, you may need to fix the firewall to allow multiple<br />        <span style="color:#bf2e5e;font-weight:400">//</span> ports to talk.  See http<span style="color:#bf2e5e;font-weight:400">://</span>www.kb.cert.org<span style="color:#bf2e5e;font-weight:400">/</span>vuls<span style="color:#bf2e5e;font-weight:400">/id/</span>800113<br /><br />        <span style="color:#bf2e5e;font-weight:400">//</span> If your ISP provided one or <span style="color:#bf2e5e;font-weight:400">more</span> IP addresses <span style="color:#bf2e5e;font-weight:400">for</span> <span style="color:#9755b3;font-weight:400">stable</span><br />        // nameservers, you probably want to use them as forwarders.<br />        // Uncomment the following block, and insert the addresses replacing<br />        // the all-0&#39;s placeholder.<br /><br />        // forwarders {<br />        //      0.0.0.0;<br />        // };<br />        //  forwarders {<br />        //8.8.8.8;<br />        //};<br />        //========================================================================<br />        // If BIND logs error messages about the root key being expired,<br />        // you will need to update your keys.  See https://www.isc.org/bind-keys<br />        //========================================================================<br />        dnssec-validation auto;<br />        listen-on port 53 {any; };<br />        //listen-on-v6 { any; };<br /><br />        // allow query<br />        allow-query {any; };<br />        allow-transfer {none;};<br />        allow-update {any;};<br />#       dnssec-validation auto;<br />        auth-nxdomain no;<br />};<br /><br />^G Help          ^O Write Out     ^W Where Is      ^K Cut           ^T Execute       ^C Location      M-U Undo         M-A Set Mark     M-] To Bracket   M-Q Previous     ^B Back          ^◂ Prev Word     ^A Home<br />^X Exit          ^R Read File     ^\ Replace       ^U Paste         ^J Justify       ^/ Go To Line    M-E Redo         M-6 Copy         ^Q Where Was     M-W Next         ^F Forward       ^▸ Next Word     ^E End<br /></pre></div><div class="codebox"><pre>  GNU nano 7.2                                                                                                named.conf.local                                                                                                          <br /><br /><span style="color:#bf2e5e;font-weight:400">//</span> Do any <span style="color:#bf2e5e;font-weight:400">local</span> configuration here<br /><span style="color:#bf2e5e;font-weight:400">//</span>inclusion de la cle tsig accessible depuis le repertoire personnalise <span style="color:#bf2e5e;font-weight:400">/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>bind<span style="color:#bf2e5e;font-weight:400">/</span>ddns<br /><br />include <span style="color:#5ebdab;font-weight:400">&quot;/etc/bind/ddns/ddclient.key&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span><br /><br /><span style="color:#bf2e5e;font-weight:400">//</span> Consider adding the 1918 zones here, <span style="color:#bf2e5e;font-weight:400">if</span> they are not used <span style="color:#bf2e5e;font-weight:400">in</span> your<br /><span style="color:#bf2e5e;font-weight:400">//</span> organization<br /><span style="color:#bf2e5e;font-weight:400">//</span>include <span style="color:#5ebdab;font-weight:400">&quot;/etc/bind/zones.rfc1918&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span><br /><br /><span style="color:#49aee6;font-weight:400">#  acl trusted-updaters { key ddns-key;};</span><br /><br /><span style="color:#bf2e5e;font-weight:400">//</span> zone directe<br />zone <span style="color:#5ebdab;font-weight:400">&quot;ansible.local&quot;</span> <span style="color:#bf2e5e;font-weight:400">{</span><br />        <span style="color:#bf2e5e;font-weight:400">type</span> master<span style="color:#bf2e5e;font-weight:400">;</span><br />        <span style="color:#bf2e5e;font-weight:400">file</span> <span style="color:#5ebdab;font-weight:400">&quot;/etc/bind/db.ansible.local&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span><br />        allow-update<span style="color:#bf2e5e;font-weight:400">{</span> key ddns-key<span style="color:#bf2e5e;font-weight:400">;};</span> <span style="color:#49aee6;font-weight:400">#permettre les mises a jour dns a partir de la cle TSIG .</span><br />        allow-query <span style="color:#bf2e5e;font-weight:400">{</span> any<span style="color:#bf2e5e;font-weight:400">;</span> <span style="color:#bf2e5e;font-weight:400">};</span><br />        journal <span style="color:#5ebdab;font-weight:400">&quot;/var/lib/bind/db.ansible.local.jnl&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span> <span style="color:#49aee6;font-weight:400">#Fichier binaire dans lequel sera enregistrer les mises a jour DNS il est tres determinant.</span><br /><br />                <span style="color:#bf2e5e;font-weight:400">};</span><br /><br /><br /><span style="color:#bf2e5e;font-weight:400">//</span>zone indirecte<br /><br />zone <span style="color:#5ebdab;font-weight:400">&quot;100.0.16.172.in-addr.arpa&quot;</span><span style="color:#bf2e5e;font-weight:400">{</span><br />        <span style="color:#bf2e5e;font-weight:400">type</span> master<span style="color:#bf2e5e;font-weight:400">;</span><br />        <span style="color:#bf2e5e;font-weight:400">file</span> <span style="color:#5ebdab;font-weight:400">&quot;/etc/bind/db.172-16-0&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span><br /><span style="color:#bf2e5e;font-weight:400">};</span><br /><br /><br /><br />^G Help          ^O Write Out     ^W Where Is      ^K Cut           ^T Execute       ^C Location      M-U Undo         M-A Set Mark     M-] To Bracket   M-Q Previous     ^B Back          ^◂ Prev Word     ^A Home<br />^X Exit          ^R Read File     ^<span style="color:#d41919;font-weight:400">\ </span>Replace       ^U Paste         ^J Justify       ^<span style="color:#bf2e5e;font-weight:400">/</span> Go To Line    M-E Redo         M-6 Copy         ^Q Where Was     M-W Next         ^F Forward       ^▸ Next Word     ^E End<br /></pre></div></p><p></p><p>Apres avoir terminer,il est preferable de toujours tester les configurations et redemarrer le service.</p><p></p><p><div class="codebox"><pre><span style="color:#49aee6;font-weight:400"># commande pour tester les fichiers de zones</span><br /><span style="color:#bf2e5e;font-weight:400">sudo</span> named-checkzone -z &lt;zone.local&gt; <span style="color:#bf2e5e;font-weight:400">/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>bind<span style="color:#bf2e5e;font-weight:400">/</span>db.zone.local <span style="color:#49aee6;font-weight:400">#ca peut etre n&#39;importe quoi</span><br /><span style="color:#bf2e5e;font-weight:400">sudo</span> named-checkzone -z &lt;zoneInverse&gt; <span style="color:#bf2e5e;font-weight:400">/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>bind<span style="color:#bf2e5e;font-weight:400">/</span>db.inverse<br /><span style="color:#bf2e5e;font-weight:400">sudo</span> named-checkconf<br /><br /><span style="color:#49aee6;font-weight:400"># redemarrer le service </span><br /><span style="color:#bf2e5e;font-weight:400">sudo</span> systemctl restart bind9<br /><span style="color:#bf2e5e;font-weight:400">sudo</span> systemctl status bind9</pre></div></p></div>
</body>
</html>
