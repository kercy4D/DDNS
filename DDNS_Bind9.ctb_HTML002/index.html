<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>DDNS_Bind9.ctb</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title level-1'>Configuration du DDNS sur Bind9</h1><br/><p><strong><h1>Definition des termes et Roles de composants</h1></strong> fait 2025/10/25 - 02:24</p><p></p><p> C&#39;est quoi <strong>un serveur DNS</strong>(Domain Name System) est un composant essentiel d&#39;internet qui agit comme un annuaire ou un repertoire telephonique pour les noms de domaine.</p><p> </p><p> Exemple : <a href="http://www.google.com">www.google.com</a> -‚Üí  142.250.192.4</p><p> </p><p> C&#39;est quoi un <strong>DDNS</strong> (Dynamic Domain Name System) est une extension du systeme DNS classique ,concue pour gerer les addresses IP Dynamiques.</p><p> </p><p> C&#39;est quoi <strong>TSIG</strong> il s&#39;agit d&#39;un mecanisme de securite base sur des cles partagees(HMAC) pour authentifier les mises a jour DNS.</p><p> </p><p> C&#39;est quoi <strong>nsupdate</strong> il s&#39;agit d&#39;un outil en ligne de commande pour envoyer des requetes de mise a jour DNS Dynamiques.</p><p> </p><p> C&#39;est quoi <strong>ddclient</strong> (ou equivalent) : il s&#39;agit d&#39;un client leger qui detecte les changements d&#39;adresse IP et envoie automatiquement des mises a jour DNS.</p><p> </p><p> C&#39;est quoi <strong>named.conf</strong> : il s&#39;agit de fichier principal de configuration.</p><p> C&#39;est quoi <strong>named.conf.local</strong> ou <strong>named.conf.options</strong> : il s&#39;agit de fichiers permettant de definir les zones et les ACLs.</p><p> </p><p><h3> Vue conceptuelle par contraste au DNS classique</h3></p><p> Le <strong>DNS</strong> associe un nom de domaine(comme google.com) a une adresse IP fixe.</p><p> </p><p> Le <strong>DDNS</strong>,lui,permet d&#39;associer un nom de domaine a une adresse IP qui change regulierement ,comme celles attribuees par les FAI aux connexions domestiques ou mobiles.Ideal pour les environnements en DHCP.</p><p> </p><p> </p><p> </p><p> </p></div><div class='page'><h1 class='title level-2'>Liste d'outils pour notre configuration en Local</h1><br/><p><strong><h2>Outils et composants pour configurer un DDNS avec BIND9</h2></strong></p><p><ol><li> <strong> BIND9(Berkeley Internet Name Domain)</strong> ‚óáServeur DNS open-source utilise pour heberger les zones DNS.<ul><li>Permet la configuration des zones dynamiques avec mises a jour securisees via TSIG.</li></ul></li></ol></p><p><ol><li><strong>TSIG</strong>(Transaction <strong>SIGnature</strong>) <ul><li>Mecanisme de securite base sur des cles partagees(HMAC) pour authentifier les mises a jour DNS.</li><li>Utilise pour securiser les mises a jour dynamiques envoyees au serveur BIND.</li></ul></li></ol></p><p><ol><li><strong>nsupdate</strong><ul><li>Mecanisme generalement cote client pour effectuer les mises a jour dans enregistrement dans les zones DNS.</li><li>Utilise les cles TSIG pour authentifier les requetes.</li><li>Ideal pour les tests manuels ou les script automatises.</li></ul></li></ol></p><p><ol><li><strong>ddclient</strong>(ou equivalent)<ul><li>Client DDNS leger qui detecte les changements d&#39;adresse IP et envoie automatiquement des mises a jour DNS.</li><li>Peut etre configure pour utiliser <strong>nsupdate</strong> avec TISG ou interagir avec des APIs de fournisseurs DDNS.</li></ul></li></ol></p><p><ol><li><strong>rndc</strong>(Remote Name Daemon Control) : est l&#39;outil de gestion a distance de BIND9.Il permet d&#39;interagir avec le serveur DNS en cours d&#39;execution sans redemarrer le service.<ul><li><ul><li>A quoi sert rndc ?<ul><li>Controle du serveur BIND: redemarrage ,rechargement des zones ,vidage du cache,verification de la configuration,etc.</li><li>Gestion des zones dynamiques: permet de geler/degeler une zone pour modifier son fichier manuellement.</li><li>Securite : utilise une cle partagee (rndc.key) pour authentifier les commandes.</li></ul></li></ul></li></ul></li></ol></p><p> </p><p><strong><h2> Commandes Utiles  </h2></strong><h2>        </h2></p><p> <table class="table"><tr><th>Commande</th><th>Description</th></tr><tr><td>rndc reload</td><td>recharge la configuration et les fichiers de zone.</td></tr><tr><td>rndc reconfig</td><td>recharge uniquement la configuration(named0conf)</td></tr><tr><td>rndc flush</td><td>Vide le DNS</td></tr><tr><td>rndc freeze zone.local</td><td>gele une zone dynamique pour les modification manuelle.</td></tr><tr><td>rndc thaw zone.local</td><td>Degele la zone et reactive les mises a jour dynamiques</td></tr><tr><td>rndc status</td><td>Affiche l&#39;etat du serveur Bind</td></tr><tr><td>rndc dumpdb</td><td>sauvegarde le cache DNS dans un fichier.</td></tr></table></p><p> </p><p><h2> Configuration de rndc</h2></p><p> </p><p> le fichier de cle par defaut est souvent:</p><p> </p><p> <div class="codebox"><pre><span style="color:#bf2e5e;font-weight:400">sudo</span> nano <span style="color:#bf2e5e;font-weight:400">/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>bind<span style="color:#bf2e5e;font-weight:400">/</span>rndc.key</pre></div></p><p> </p><p> Il doit etre reference dans <strong>named.conf</strong> :</p><p> </p><p> <div class="codebox"><pre>include <span style="color:#5ebdab;font-weight:400">&quot;/etc/bind/rndc.key&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span></pre></div></p><p> </p><p> Et dans le bloc <strong>controls</strong> :</p><p> </p><p> <div class="codebox"><pre>controls <span style="color:#bf2e5e;font-weight:400">{</span><br />	inet 127.0.0.1 port 53<br />	allow <span style="color:#bf2e5e;font-weight:400">{</span>127.0.0.1<span style="color:#bf2e5e;font-weight:400">;}</span>keys <span style="color:#bf2e5e;font-weight:400">{</span><span style="color:#5ebdab;font-weight:400">&quot;rndc-key&quot;</span><span style="color:#bf2e5e;font-weight:400">;};</span><br />	<span style="color:#bf2e5e;font-weight:400">}</span></pre></div></p><p> </p><p> </p></div><div class='page'><h1 class='title level-2'>Architecture de base</h1><br/><p>Dans ce projet j&#39;ai utilise GNS3 et VMware pour realiser mon architecture et je dois dire que le resultat me satisfait vraiment.</p><p></p><p><strong>Objectif:</strong></p><p>Initialement , j&#39;ai voulu implementer Ansible dans mon architecture pour deployer des services mais je me suis rendu compte d&#39;une chose üòÅÔ∏è mes adresses IP changeaient a chaque redemarrage systeme etant donnee que j&#39;ai configurer mon routeur Cisco 7200 pour qu&#39;il face office de serveur DHCP alors la solution qui s&#39;offrait a moi etait de creer une mise a jour dynamique du nom de domaine de mes clients.</p><p></p><p></p><p><strong><h1>Architecture de Base</h1></strong></p><p></p><p><img src="images/3-1.png" alt="images/3-1.png" /></p><p></p><p>Dans la suite de notre document ,je vais tout  d&#39;abord presenter la configuration faite sur le serveur bind9 et ensuite celles faites sur les clients.</p></div><div class='page'><h1 class='title level-3'>Configuration Serveur</h1><br/><p>Tout d&#39;abord , j&#39;ai commence par changer les droits utilisateurs sur les fichiers de configuration comme suit.</p><p></p><p><h3>Generer la cle TSIG</h3></p><p><div class="codebox"><pre><span style="color:#bf2e5e;font-weight:400">sudo</span> tsig-keygen -a HMAC-SHA256 ddns-key &gt; <span style="color:#bf2e5e;font-weight:400">/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>bind<span style="color:#bf2e5e;font-weight:400">/</span>ddns<span style="color:#bf2e5e;font-weight:400">/</span>ddclient.key</pre></div></p><p>le resultat du cotenu du fichier devrait ressembler a :</p><p><div class="codebox"><pre>key <span style="color:#5ebdab;font-weight:400">&quot;ddns-key&quot;</span> <span style="color:#bf2e5e;font-weight:400">{</span><br />        algorithm hmac-sha256<span style="color:#bf2e5e;font-weight:400">;</span><br />        secret <span style="color:#5ebdab;font-weight:400">&quot;uW1B399nahrFJT/rmHGaSaz6MbAJS7Q05J7hEQ/7V/M=&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span><br /><span style="color:#bf2e5e;font-weight:400">};</span><br /></pre></div></p><p>C&#39;est cette meme cle qui sera partager entre le serveur et le client.</p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p></p><p><strong>NB</strong>: Nos configuration se feront dans le repertoire<em> /etc/bind </em>de notre serveur DNS.</p><p></p><p><div class="codebox"><pre>kercy@ansible<span style="color:#bf2e5e;font-weight:400">:/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>bind$ <span style="color:#bf2e5e;font-weight:400">ls</span> -alh db.*<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 255 Aug 21 15<span style="color:#bf2e5e;font-weight:400">:</span>46 db.0<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 271 Oct 19 04<span style="color:#bf2e5e;font-weight:400">:</span>21 db.127.bck<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 298 Oct 19 14<span style="color:#bf2e5e;font-weight:400">:</span>21 db.172-16-0<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 237 Aug 18 18<span style="color:#bf2e5e;font-weight:400">:</span>02 db.255<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 328 Oct 24 14<span style="color:#bf2e5e;font-weight:400">:</span>10 db.ansible.local<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 353 Aug 18 18<span style="color:#bf2e5e;font-weight:400">:</span>02 db.empty<br />-rw-rw<span style="color:#4a88f1;font-weight:400">-r</span>-- 1 <span style="color:#bf2e5e;font-weight:400">bind</span> <span style="color:#bf2e5e;font-weight:400">bind</span> 270 Oct 19 04<span style="color:#bf2e5e;font-weight:400">:</span>21 db.local.bck<br /><br /><span style="color:#bf2e5e;font-weight:400">//</span> pour changer et obtenir le resultat ci-dessus ,utilise la commande<br /><br /><span style="color:#bf2e5e;font-weight:400">sudo</span> <span style="color:#bf2e5e;font-weight:400">chown</span> bind<span style="color:#bf2e5e;font-weight:400">:</span>bind db.*<br /><span style="color:#bf2e5e;font-weight:400">sudo</span> <span style="color:#bf2e5e;font-weight:400">chmod</span> 664 db.*<br /><br />kercy@ansible<span style="color:#bf2e5e;font-weight:400">:/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>bind$ <span style="color:#bf2e5e;font-weight:400">ls</span> -alh named.conf*<br />-rw<span style="color:#4a88f1;font-weight:400">-r</span>--r-- 1 root <span style="color:#bf2e5e;font-weight:400">bind</span>  461 Oct 23 14<span style="color:#bf2e5e;font-weight:400">:</span>59 named.conf<br />-rw<span style="color:#4a88f1;font-weight:400">-r</span>--r-- 1 root <span style="color:#bf2e5e;font-weight:400">bind</span>  498 Aug 18 18<span style="color:#bf2e5e;font-weight:400">:</span>02 named.conf.default-zones<br />-rw<span style="color:#4a88f1;font-weight:400">-r</span>--r-- 1 root <span style="color:#bf2e5e;font-weight:400">bind</span>  630 Oct 24 14<span style="color:#bf2e5e;font-weight:400">:</span>08 named.conf.local<br />-rw<span style="color:#4a88f1;font-weight:400">-r</span>--r-- 1 root <span style="color:#bf2e5e;font-weight:400">bind</span>  165 Oct 19 04<span style="color:#bf2e5e;font-weight:400">:</span>17 named.conf.local.bck<br />-rw<span style="color:#4a88f1;font-weight:400">-r</span>--r-- 1 root <span style="color:#bf2e5e;font-weight:400">bind</span> 1.1K Oct 24 03<span style="color:#bf2e5e;font-weight:400">:</span>51 named.conf.options<br /> </pre></div></p><p></p><p>Ici ,pour eviter de refaire a zero le travail ,j&#39;ai simplement copier le fichier par defaut de configuration de la zone directe et de la zone indirecte ,je leur ai attribuer un nom plus intuitif .Petit rappel ne jamais oublier de creer des fichiers de backup au cas ou ca crame.</p><p><ul><li>Configuration de la<strong> zone Directe</strong></li></ul></p><p></p><p><div class="codebox"><pre>  GNU nano 7.2                                                                                                 db.ansible.local                                                                                                          <br /><span style="color:#bf2e5e;font-weight:400">;</span><br /><span style="color:#bf2e5e;font-weight:400">;</span> BIND data <span style="color:#bf2e5e;font-weight:400">file</span> <span style="color:#bf2e5e;font-weight:400">for</span> <span style="color:#9755b3;font-weight:400">local</span> loopback interface<br />;<br />$TTL    604800<br />@       IN      SOA     ns1.ansible.local. kercy.ansible.local. (<br />                              2         ; Serial<br />                         604800         ; Refresh<br />                          86400         ; Retry<br />                        2419200         ; Expire<br />                         604800 )       ; Negative Cache TTL<br />;<br />@       IN      NS      ns1.ansible.local.<br />ns1     IN      A       172.16.0.100<br />@       IN      A       172.16.0.100<br />myhost  IN      A       192.168.10.30<br /><br /><br /><br /><br /><br /><br />^G Help          ^O Write Out     ^W Where Is      ^K Cut           ^T Execute       ^C Location      M-U Undo         M-A Set Mark     M-] To Bracket   M-Q Previous     ^B Back          ^‚óÇ Prev Word     ^A Home<br />^X Exit          ^R Read File     ^\ Replace       ^U Paste         ^J Justify       ^/ Go To Line    M-E Redo         M-6 Copy         ^Q Where Was     M-W Next         ^F Forward       ^‚ñ∏ Next Word     ^E End<br /></pre></div></p><p><ul><li>Configuration de la <strong>zone Indirecte</strong></li></ul></p><p></p><p></p><p><div class="codebox"><pre>  GNU nano 7.2                                                                                                   db.172-16-0                                                                                                             <br /><span style="color:#bf2e5e;font-weight:400">;</span><br /><span style="color:#bf2e5e;font-weight:400">;</span> BIND reverse data <span style="color:#bf2e5e;font-weight:400">file</span> <span style="color:#bf2e5e;font-weight:400">for</span> <span style="color:#9755b3;font-weight:400">local</span> loopback interface<br />;<br />$TTL    604800<br />@       IN      SOA     ns1.ansible.local. kercy.ansible.local. (<br />                              1         ; Serial<br />                         604800         ; Refresh<br />                          86400         ; Retry<br />                        2419200         ; Expire<br />                         604800 )       ; Negative Cache TTL<br />;<br />@       IN      NS      ns1.ansible.local.<br />100     IN      PTR     ns1.ansible.local.<br /><br />                                                                                                            [ Read 13 lines ]<br />^G Help          ^O Write Out     ^W Where Is      ^K Cut           ^T Execute       ^C Location      M-U Undo         M-A Set Mark     M-] To Bracket   M-Q Previous     ^B Back          ^‚óÇ Prev Word     ^A Home<br />^X Exit          ^R Read File     ^\ Replace       ^U Paste         ^J Justify       ^/ Go To Line    M-E Redo         M-6 Copy         ^Q Where Was     M-W Next         ^F Forward       ^‚ñ∏ Next Word     ^E End<br /></pre></div></p><p><ul><li>Configuration des fichiers<strong> named.conf*</strong></li></ul></p><p>				</p><p></p><p><div class="codebox"><pre>  GNU nano 7.2                                                                                               named.conf.options                                                                                                         <br />options <span style="color:#bf2e5e;font-weight:400">{</span><br />        directory <span style="color:#5ebdab;font-weight:400">&quot;/var/cache/bind&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span><br /><br />        <span style="color:#bf2e5e;font-weight:400">//</span> If there is a firewall between you and nameservers you want<br />        <span style="color:#bf2e5e;font-weight:400">//</span> to talk to, you may need to fix the firewall to allow multiple<br />        <span style="color:#bf2e5e;font-weight:400">//</span> ports to talk.  See http<span style="color:#bf2e5e;font-weight:400">://</span>www.kb.cert.org<span style="color:#bf2e5e;font-weight:400">/</span>vuls<span style="color:#bf2e5e;font-weight:400">/id/</span>800113<br /><br />        <span style="color:#bf2e5e;font-weight:400">//</span> If your ISP provided one or <span style="color:#bf2e5e;font-weight:400">more</span> IP addresses <span style="color:#bf2e5e;font-weight:400">for</span> <span style="color:#9755b3;font-weight:400">stable</span><br />        // nameservers, you probably want to use them as forwarders.<br />        // Uncomment the following block, and insert the addresses replacing<br />        // the all-0&#39;s placeholder.<br /><br />        // forwarders {<br />        //      0.0.0.0;<br />        // };<br />        //  forwarders {<br />        //8.8.8.8;<br />        //};<br />        //========================================================================<br />        // If BIND logs error messages about the root key being expired,<br />        // you will need to update your keys.  See https://www.isc.org/bind-keys<br />        //========================================================================<br />        dnssec-validation auto;<br />        listen-on port 53 {any; };<br />        //listen-on-v6 { any; };<br /><br />        // allow query<br />        allow-query {any; };<br />        allow-transfer {none;};<br />        allow-update {any;};<br />#       dnssec-validation auto;<br />        auth-nxdomain no;<br />};<br /><br />^G Help          ^O Write Out     ^W Where Is      ^K Cut           ^T Execute       ^C Location      M-U Undo         M-A Set Mark     M-] To Bracket   M-Q Previous     ^B Back          ^‚óÇ Prev Word     ^A Home<br />^X Exit          ^R Read File     ^\ Replace       ^U Paste         ^J Justify       ^/ Go To Line    M-E Redo         M-6 Copy         ^Q Where Was     M-W Next         ^F Forward       ^‚ñ∏ Next Word     ^E End<br /></pre></div><div class="codebox"><pre>  GNU nano 7.2                                                                                                named.conf.local                                                                                                          <br /><br /><span style="color:#bf2e5e;font-weight:400">//</span> Do any <span style="color:#bf2e5e;font-weight:400">local</span> configuration here<br /><span style="color:#bf2e5e;font-weight:400">//</span>inclusion de la cle tsig accessible depuis le repertoire personnalise <span style="color:#bf2e5e;font-weight:400">/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>bind<span style="color:#bf2e5e;font-weight:400">/</span>ddns<br /><br />include <span style="color:#5ebdab;font-weight:400">&quot;/etc/bind/ddns/ddclient.key&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span><br /><br /><span style="color:#bf2e5e;font-weight:400">//</span> Consider adding the 1918 zones here, <span style="color:#bf2e5e;font-weight:400">if</span> they are not used <span style="color:#bf2e5e;font-weight:400">in</span> your<br /><span style="color:#bf2e5e;font-weight:400">//</span> organization<br /><span style="color:#bf2e5e;font-weight:400">//</span>include <span style="color:#5ebdab;font-weight:400">&quot;/etc/bind/zones.rfc1918&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span><br /><br /><span style="color:#49aee6;font-weight:400">#  acl trusted-updaters { key ddns-key;};</span><br /><br /><span style="color:#bf2e5e;font-weight:400">//</span> zone directe<br />zone <span style="color:#5ebdab;font-weight:400">&quot;ansible.local&quot;</span> <span style="color:#bf2e5e;font-weight:400">{</span><br />        <span style="color:#bf2e5e;font-weight:400">type</span> master<span style="color:#bf2e5e;font-weight:400">;</span><br />        <span style="color:#bf2e5e;font-weight:400">file</span> <span style="color:#5ebdab;font-weight:400">&quot;/etc/bind/db.ansible.local&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span><br />        allow-update<span style="color:#bf2e5e;font-weight:400">{</span> key ddns-key<span style="color:#bf2e5e;font-weight:400">;};</span> <span style="color:#49aee6;font-weight:400">#permettre les mises a jour dns a partir de la cle TSIG .</span><br />        allow-query <span style="color:#bf2e5e;font-weight:400">{</span> any<span style="color:#bf2e5e;font-weight:400">;</span> <span style="color:#bf2e5e;font-weight:400">};</span><br />        journal <span style="color:#5ebdab;font-weight:400">&quot;/var/lib/bind/db.ansible.local.jnl&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span> <span style="color:#49aee6;font-weight:400">#Fichier binaire dans lequel sera enregistrer les mises a jour DNS il est tres determinant.</span><br /><br />                <span style="color:#bf2e5e;font-weight:400">};</span><br /><br /><br /><span style="color:#bf2e5e;font-weight:400">//</span>zone indirecte<br /><br />zone <span style="color:#5ebdab;font-weight:400">&quot;100.0.16.172.in-addr.arpa&quot;</span><span style="color:#bf2e5e;font-weight:400">{</span><br />        <span style="color:#bf2e5e;font-weight:400">type</span> master<span style="color:#bf2e5e;font-weight:400">;</span><br />        <span style="color:#bf2e5e;font-weight:400">file</span> <span style="color:#5ebdab;font-weight:400">&quot;/etc/bind/db.172-16-0&quot;</span><span style="color:#bf2e5e;font-weight:400">;</span><br /><span style="color:#bf2e5e;font-weight:400">};</span><br /><br /><br /><br />^G Help          ^O Write Out     ^W Where Is      ^K Cut           ^T Execute       ^C Location      M-U Undo         M-A Set Mark     M-] To Bracket   M-Q Previous     ^B Back          ^‚óÇ Prev Word     ^A Home<br />^X Exit          ^R Read File     ^<span style="color:#d41919;font-weight:400">\ </span>Replace       ^U Paste         ^J Justify       ^<span style="color:#bf2e5e;font-weight:400">/</span> Go To Line    M-E Redo         M-6 Copy         ^Q Where Was     M-W Next         ^F Forward       ^‚ñ∏ Next Word     ^E End<br /></pre></div></p><p></p><p>Apres avoir terminer,il est preferable de toujours tester les configurations et redemarrer le service.</p><p></p><p><div class="codebox"><pre><span style="color:#49aee6;font-weight:400"># commande pour tester les fichiers de zones</span><br /><span style="color:#bf2e5e;font-weight:400">sudo</span> named-checkzone -z &lt;zone.local&gt; <span style="color:#bf2e5e;font-weight:400">/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>bind<span style="color:#bf2e5e;font-weight:400">/</span>db.zone.local <span style="color:#49aee6;font-weight:400">#ca peut etre n&#39;importe quoi</span><br /><span style="color:#bf2e5e;font-weight:400">sudo</span> named-checkzone -z &lt;zoneInverse&gt; <span style="color:#bf2e5e;font-weight:400">/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>bind<span style="color:#bf2e5e;font-weight:400">/</span>db.inverse<br /><span style="color:#bf2e5e;font-weight:400">sudo</span> named-checkconf<br /><br /><span style="color:#49aee6;font-weight:400"># redemarrer le service </span><br /><span style="color:#bf2e5e;font-weight:400">sudo</span> systemctl restart bind9<br /><span style="color:#bf2e5e;font-weight:400">sudo</span> systemctl status bind9</pre></div></p></div><div class='page'><h1 class='title level-3'>Configuration client</h1><br/><p>Pour le cote client,deux principales solutions s&#39;offres a nous,utilisation de ddclient ou bien un shellscript base sur nsupdate.Pour mon  cas,j&#39;ai opte pour le script car ca me permet de mieux comprendre ce qui se passe .</p><p></p><p><img src="images/5-1.png" alt="images/5-1.png" /></p><p></p><p>Il s&#39;agit de la cle precedement creer du cote du serveur DNS,nous l&#39;avons importe du cote.</p><p></p><p><img src="images/5-2.png" alt="images/5-2.png" /></p><p></p><p></p><p><div class="codebox"><pre><span style="color:#49aee6;font-weight:400"># on doit les droits d&#39;exection et on execute le script comme suit:</span><br /><span style="color:#bf2e5e;font-weight:400">sudo</span> <span style="color:#bf2e5e;font-weight:400">chmod</span> +x ddns-cli.sh<br /><span style="color:#49aee6;font-weight:400"># execute</span><br />.<span style="color:#bf2e5e;font-weight:400">/</span>ddns-cli.sh</pre></div></p><p></p></div><div class='page'><h1 class='title level-2'>authentification et deploiement</h1><br/><p><h2>Authentification</h2></p><p></p><p>Pour que Ansible puisse facilement etre deployer, il faudrait deja que la cle publique pour la connexion ssh soit existante et deja configurer sur l&#39;hote distant.Que faut-il faire pour que se soit le cas?Nous allons repondre plus bas a cette question.</p><p></p><p>Etapes pour mettre en place l&#39;authentification de notre serveur vers nos clients.</p><p><ol><li>generer une cle public pour ssh via la commande:</p><p></li></ol><div class="codebox"><pre><span style="color:#bf2e5e;font-weight:400">ssh-keygen</span> -t ed25519 -C <span style="color:#5ebdab;font-weight:400">&quot;ton_mail@exemple.com&quot;</span></pre></div></p><p>A ce niveau,j&#39;ai plutot mis l&#39;adresse de mon hote distant cad : kercy@rssi.ansible.local</p><p></p><p><strong>NB</strong>: Ici ,nous pouvons definir une <strong>passphrase</strong> ce qui est optionnel mais que je credite beaucoup en terme de securite.</p><p><ol><li>Copier la cle publique sur le serveur qui ici est notre client ansible via la commande .</p><p></li></ol><div class="codebox"><pre>ssh-copy-id -i &lt;chemin_de_la_cle_publique.pub&gt; kercy@rssi.ansible.local</pre></div></p><p><ol><li>Verifier les permissions sur le serveur qui ici est notre client ansible</p><p></li></ol><div class="codebox"><pre><span style="color:#bf2e5e;font-weight:400">sudo</span> <span style="color:#bf2e5e;font-weight:400">chmod</span> 700 ~<span style="color:#bf2e5e;font-weight:400">/</span>.ssh<br /><span style="color:#bf2e5e;font-weight:400">sudo</span> <span style="color:#bf2e5e;font-weight:400">chmod</span> 600 ~<span style="color:#bf2e5e;font-weight:400">/</span>.ssh<span style="color:#bf2e5e;font-weight:400">/</span>autorized_keys</pre></div></p><p><ol><li>desactiver l&#39;authentification par mot de passe </li></ol></p><p></p><p>Dans <span style="background-color:#77767b;">/etc/ssh/sshd_config</span> sur le serveur qui ici est notre client ansible.</p><p></p><p><div class="codebox"><pre>PasswordAuthentication no<br />PubKeyAuthentication yes</pre></div></p><p><ol><li>Redemarrer le service SSH</li></ol></p><p></p><p><div class="codebox"><pre><span style="color:#bf2e5e;font-weight:400">sudo</span> systemctl restart sshd</pre></div></p></div>
</body>
</html>
